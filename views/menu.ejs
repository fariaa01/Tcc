<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Pedidos</title>
  <link rel="stylesheet" href="/menu/menu.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

</head>
<body>
  <div class="container">
    <h2>Gestão de pedidos</h2>
    <button class="btn-add" id="btnAbrirCategoria">
      <i class="fas fa-plus"></i> Adicionar pedido
    </button>
  </div>

  <div class="grid-cards">
    <% pedidos.forEach(p => { %>
      <div class="card">
        <% if (p.foto) { %>
          <img src="/uploads/<%= p.foto %>" alt="Foto do prato">
        <% } else { %>
          <div class="img-placeholder">Sem imagem</div>
        <% } %>
        <div class="card-body">
          <h3><%= p.pedido %></h3>
          <p><strong>Cliente:</strong> <%= p.nome_cliente %></p>
          <p><strong>Ingredientes:</strong> <%= p.ingredientes %></p>
          <p><strong>Quantidade:</strong> <%= p.quantidade %></p>
          <p><strong>Preço:</strong> R$ <%= parseFloat(p.preco).toFixed(2) %></p>
          <% if (p.observacoes) { %>
            <p><strong>Obs:</strong> <%= p.observacoes %></p>
          <% } %>
          <form action="/menu/excluir/<%= p.id %>" method="POST" class="form-excluir">
            <button type="submit" class="btn-excluir">Excluir</button>
          </form>
        </div>
      </div>
    <% }) %>
  </div>

 <a href="/dashboard" class="btn-voltar"><i class="fas fa-arrow-left"></i> Voltar</a>
 
  <div id="modalCategoria" class="modal">
    <div class="modal-content">
      <span class="close" id="fecharCategoria">&times;</span>
      <h3>Escolher Categoria</h3>
      <select id="selectCategoria" required>
        <option value="">Selecione...</option>
        <option value="lanche">Lanche</option>
        <option value="bebida">Bebida</option>
        <option value="sobremesa">Sobremesa</option>
      </select>
       <button class="btn-avancar" id="btnAvancar">Avançar</button>
    </div>
  </div>

  <div id="modalPedido" class="modal">
    <div class="modal-content-pedido">
      <span id="fecharModal" class="close">&times;</span>
      <h3 id="tituloModal">Novo Pedido</h3>
      <form method="POST" action="/menu" class="form-box" enctype="multipart/form-data">
        <input type="hidden" name="categoria" id="inputCategoria" />
        <input type="text" name="nome_cliente" placeholder="Nome do cliente" required />
        <input type="text" name="pedido" placeholder="Pedido" required />
        <div id="camposDinamicos"></div>
        <input type="text" name="ingredientes" placeholder="Ingredientes" required />
        <input type="number" name="quantidade" placeholder="Quantidade" min="1" required />
        <input type="number" step="0.01" name="preco" placeholder="Preço (R$)" required />
        <textarea name="observacoes" placeholder="Observações" id="observacoes"></textarea>
       <input type="file" name="foto" accept="image/*" id="foto" style="display:none;">
       <label for="foto" class="btn-arquivo">Escolher imagem <image src="/img/upload.png" alt="Upload"></image></label>
        <span id="nome-arquivo"></span>
        <button class="btn-cadastrar" id="btnCadastrar">Cadastrar</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    // Confirmação de exclusão com SweetAlert2
    document.querySelectorAll('.form-excluir').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        Swal.fire({
          title: "Tem certeza?",
          text: "Você não poderá reverter isso!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#c0392b",
          cancelButtonColor: "#4c4b4b",
          confirmButtonText: "Sim, excluir!"
        }).then((result) => {
          if (result.isConfirmed) {
            form.submit();
          }
        });
      });
    });
    const btnAbrirCategoria = document.getElementById("btnAbrirCategoria");
    const modalCategoria = document.getElementById("modalCategoria");
    const modalPedido = document.getElementById("modalPedido");
    const fecharCategoria = document.getElementById("fecharCategoria");
    const fecharModal = document.getElementById("fecharModal");
    const selectCategoria = document.getElementById("selectCategoria");
    const inputCategoria = document.getElementById("inputCategoria");
    const camposDinamicos = document.getElementById("camposDinamicos");
    const tituloModal = document.getElementById("tituloModal");

    btnAbrirCategoria.onclick = () => modalCategoria.style.display = "block";
    fecharCategoria.onclick = () => modalCategoria.style.display = "none";
    fecharModal.onclick = () => modalPedido.style.display = "none";

    window.onclick = (event) => {
      if (event.target == modalCategoria) modalCategoria.style.display = "none";
      if (event.target == modalPedido) modalPedido.style.display = "none";
    };

    document.getElementById("btnAvancar").onclick = () => {
      const categoria = selectCategoria.value;
      if (!categoria) {
        alert("Selecione uma categoria.");
        return;
      }

      inputCategoria.value = categoria;
      tituloModal.innerText = "Novo Pedido - " + categoria.charAt(0).toUpperCase() + categoria.slice(1);
      camposDinamicos.innerHTML = "";

      if (categoria === "bebida") {
        camposDinamicos.innerHTML = `
  <input type="number" name="volume" placeholder="Volume (ml)" class="form-box-input" />
  <select name="com_gelo" class="form-box-input">
    <option value="">Com gelo?</option>
    <option value="sim">Sim</option>
    <option value="nao">Não</option>
  </select>`;
      } else if (categoria === "lanche") {
        camposDinamicos.innerHTML = `
          <input type="text" name="tamanho" placeholder="Tamanho do lanche" />
          <input type="text" name="acompanhamento" placeholder="Acompanhamento" />`;
      }

      modalCategoria.style.display = "none";
      modalPedido.style.display = "block";
    };
  </script>
</body>
</html>
