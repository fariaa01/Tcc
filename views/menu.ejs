<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Pedidos</title>
  <link rel="stylesheet" href="/css/funcionarios.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #ECF0F1;
      padding: 10px;
    }

    .grid-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .img-placeholder {
      height: 180px;
      background: #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #444;
      font-size: 16px;
    }

    .card-body {
      padding: 15px;
    }

    .card-body h3 {
      margin-top: 0;
      font-size: 18px;
    }

    .card-body p {
      margin: 5px 0;
      font-size: 14px;
    }

    .btn-excluir {
      margin-top: 10px;
      padding: 6px 12px;
      background: #e74c3c;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-excluir:hover {
      background: #c0392b;
    }

    .btn-voltar {
      margin: 20px;
      display: inline-block;
      padding: 10px 20px;
      background: #3498db;
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
    }

    .btn-add{
      background: #1abc9c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.3s;
    }

    .modal {
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      display: none;
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }

    .close {
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .form-box input,
    .form-box textarea,
    .form-box select {
      width: 95%;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }


    .btn-avancar {
      width: 17%;
      height: 25px;
      background: #1abc9c;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-avancar:hover {
      background: #18b394;
    }

  </style>
</head>
<body>
  <div class="container">
    <h2>Gestão de pedidos</h2>
    <button class="btn-add" id="btnAbrirCategoria">
      <i class="fas fa-plus"></i> Adicionar pedido
    </button>
  </div>

  <div class="grid-cards">
    <% pedidos.forEach(p => { %>
      <div class="card">
        <% if (p.foto) { %>
          <img src="/uploads/<%= p.foto %>" alt="Foto do prato">
        <% } else { %>
          <div class="img-placeholder">Sem imagem</div>
        <% } %>
        <div class="card-body">
          <h3><%= p.pedido %></h3>
          <p><strong>Cliente:</strong> <%= p.nome_cliente %></p>
          <p><strong>Ingredientes:</strong> <%= p.ingredientes %></p>
          <p><strong>Quantidade:</strong> <%= p.quantidade %></p>
          <p><strong>Preço:</strong> R$ <%= parseFloat(p.preco).toFixed(2) %></p>
          <% if (p.observacoes) { %>
            <p><strong>Obs:</strong> <%= p.observacoes %></p>
          <% } %>
          <form action="/menu/excluir/<%= p.id %>" method="POST" onsubmit="return confirm('Deseja excluir este pedido?')">
            <button type="submit" class="btn-excluir">Excluir</button>
          </form>
        </div>
      </div>
    <% }) %>
  </div>

 <a href="/dashboard" class="btn-voltar"><i class="fas fa-arrow-left"></i> Voltar</a>
 
  <div id="modalCategoria" class="modal">
    <div class="modal-content">
      <span class="close" id="fecharCategoria">&times;</span>
      <h3>Escolher Categoria</h3>
      <select id="selectCategoria" required>
        <option value="">Selecione...</option>
        <option value="lanche">Lanche</option>
        <option value="bebida">Bebida</option>
        <option value="sobremesa">Sobremesa</option>
      </select>
       <button class="btn-avancar" id="btnAvancar">Avançar</button>
    </div>
  </div>

  <div id="modalPedido" class="modal">
    <div class="modal-content">
      <span id="fecharModal" class="close">&times;</span>
      <h3 id="tituloModal">Novo Pedido</h3>
      <form method="POST" action="/menu" class="form-box" enctype="multipart/form-data">
        <input type="hidden" name="categoria" id="inputCategoria" />
        <input type="text" name="nome_cliente" placeholder="Nome do cliente" required />
        <input type="text" name="pedido" placeholder="Pedido" required />
        <div id="camposDinamicos"></div>
        <input type="text" name="ingredientes" placeholder="Ingredientes" required />
        <input type="number" name="quantidade" placeholder="Quantidade" min="1" required />
        <input type="number" step="0.01" name="preco" placeholder="Preço (R$)" required />
        <textarea name="observacoes" placeholder="Observações"></textarea>
        <input type="file" name="foto" accept="image/*" />
        <button type="submit">Cadastrar</button>
      </form>
    </div>
  </div>

  <script>
    const btnAbrirCategoria = document.getElementById("btnAbrirCategoria");
    const modalCategoria = document.getElementById("modalCategoria");
    const modalPedido = document.getElementById("modalPedido");
    const fecharCategoria = document.getElementById("fecharCategoria");
    const fecharModal = document.getElementById("fecharModal");
    const selectCategoria = document.getElementById("selectCategoria");
    const inputCategoria = document.getElementById("inputCategoria");
    const camposDinamicos = document.getElementById("camposDinamicos");
    const tituloModal = document.getElementById("tituloModal");

    btnAbrirCategoria.onclick = () => modalCategoria.style.display = "block";
    fecharCategoria.onclick = () => modalCategoria.style.display = "none";
    fecharModal.onclick = () => modalPedido.style.display = "none";

    window.onclick = (event) => {
      if (event.target == modalCategoria) modalCategoria.style.display = "none";
      if (event.target == modalPedido) modalPedido.style.display = "none";
    };

    document.getElementById("btnAvancar").onclick = () => {
      const categoria = selectCategoria.value;
      if (!categoria) {
        alert("Selecione uma categoria.");
        return;
      }

      inputCategoria.value = categoria;
      tituloModal.innerText = "Novo Pedido - " + categoria.charAt(0).toUpperCase() + categoria.slice(1);
      camposDinamicos.innerHTML = "";

      if (categoria === "bebida") {
        camposDinamicos.innerHTML = `
  <input type="number" name="volume" placeholder="Volume (ml)" class="form-box-input" />
  <select name="com_gelo" class="form-box-input">
    <option value="">Com gelo?</option>
    <option value="sim">Sim</option>
    <option value="nao">Não</option>
  </select>`;
      } else if (categoria === "lanche") {
        camposDinamicos.innerHTML = `
          <input type="text" name="tamanho" placeholder="Tamanho do lanche" />
          <input type="text" name="acompanhamento" placeholder="Acompanhamento" />`;
      }

      modalCategoria.style.display = "none";
      modalPedido.style.display = "block";
    };
  </script>
</body>
</html>
